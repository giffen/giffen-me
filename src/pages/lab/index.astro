---
import BaseLayout from "../../layouts/BaseLayout.astro";
import LabCard from "../../components/LabCard.astro";
import { getCollection } from "astro:content";

const labPosts = await getCollection("lab");
const publishedPosts = labPosts
  .filter(labPosts => labPosts.data.published !== false)
  .sort((a, b) => (a.data.date < b.data.date ? 1 : -1));
---

<BaseLayout title="Lab â€” Andrew Giffen" description="Experiments and learning projects in product, engineering, and design.">
  <section class="lab-page">
    <header class="page-header">
      <p class="page-label">The Lab</p>
      <h1 class="page-title">Experiments & Learning Projects</h1>
      <p class="page-description">
        This is where I document what I'm building and learning. Each project includes 
        the problem I was solving, what I learned, and what I'd do differently next time.
      </p>
    </header>

    <div class="lab-grid">
      {publishedPosts.map((post, index) => (
        <article class="lab-grid-card">
          <a href={`/lab/${post.slug}`} class="lab-grid-link">
            <div class={`lab-grid-cover ${post.data.image ? 'has-image' : `lab-pattern-${post.data.pattern || ((index % 6) + 1)}`}`}>
              {post.data.image && (
                <img 
                  src={post.data.image} 
                  alt="" 
                  class="lab-grid-image"
                  loading="lazy"
                />
              )}
              {post.data.image && <div class="lab-grid-image-overlay"></div>}
              <div class="lab-grid-content">
                <p class="lab-grid-meta">
                  {post.data.date.split('-')[0]}
                  {post.data.status === 'in-progress' && <span class="status-badge">In Progress</span>}
                </p>
                <h2 class="lab-grid-title">{post.data.title}</h2>
                <div class="lab-grid-tags">
                  {post.data.tags.map((tag, i) => (
                    <span class="lab-grid-tag">{tag}</span>
                  ))}
                </div>
              </div>
            </div>
            <div class="lab-grid-info">
              <p class="lab-grid-description">{post.data.description}</p>
              <span class="lab-grid-cta">
                Read more
                <svg viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
              </span>
            </div>
          </a>
        </article>
      ))}
    </div>
  </section>
</BaseLayout>

<style>
  .lab-page {
    padding: var(--space-10) var(--space-7);
    min-height: 100vh;
  }

  .page-header {
    max-width: 600px;
    margin-bottom: var(--space-9);
  }

  .page-label {
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 0.15em;
    margin-bottom: var(--space-4);
  }

  .page-title {
    font-family: var(--font-display);
    font-size: var(--text-4xl);
    font-weight: 400;
    color: var(--ink);
    margin-bottom: var(--space-5);
    line-height: 1.2;
  }

  .page-description {
    font-size: var(--text-lg);
    color: var(--ink-soft);
    line-height: 1.7;
  }

  .lab-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: var(--space-6);
  }

  .lab-grid-card {
    background: var(--cream);
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 
      4px 4px 0 0 var(--paper-edge),
      1px 1px 4px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
  }

  .lab-grid-card:hover {
    transform: translateY(-4px);
    box-shadow: 
      6px 8px 0 0 var(--paper-edge),
      2px 4px 12px rgba(0,0,0,0.12);
  }

  .lab-grid-link {
    display: block;
    text-decoration: none;
    color: inherit;
  }

  .lab-grid-cover {
    height: 200px;
    padding: var(--space-5);
    position: relative;
    overflow: hidden;
  }

  /* Image background styles */
  .lab-grid-cover.has-image {
    padding: 0;
    background: linear-gradient(135deg, #2D3A35 0%, #1A2420 100%);
  }

  .lab-grid-image {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 60%;
    width: 100%;
    object-fit: cover;
    object-position: center;
  }

  .lab-grid-image-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      to bottom,
      transparent 0%,
      transparent 40%,
      rgba(30, 25, 20, 0.95) 60%,
      rgba(30, 25, 20, 1) 100%
    );
    z-index: 1;
  }

  .lab-grid-cover.has-image .lab-grid-content {
    padding: var(--space-5);
    padding-left: calc(var(--space-5) + var(--space-3));
  }

  .lab-grid-cover::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 12px;
    background: linear-gradient(90deg, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.1) 50%, transparent 100%);
    z-index: 5;
  }

  .lab-pattern-1 { background: linear-gradient(180deg, #1E4B8E 0%, #152F54 100%); }
  .lab-pattern-2 { background: linear-gradient(180deg, #8E4B1E 0%, #5C3012 100%); }
  .lab-pattern-3 { background: linear-gradient(180deg, #1E8E4B 0%, #125C2F 100%); }
  .lab-pattern-4 { background: linear-gradient(180deg, #4B1E8E 0%, #2F125C 100%); }
  .lab-pattern-5 { background: linear-gradient(180deg, #8E1E4B 0%, #5C122F 100%); }
  .lab-pattern-6 { background: linear-gradient(180deg, #2D4A3E 0%, #1A2D26 100%); }

  .lab-grid-content {
    height: 100%;
    display: flex;
    flex-direction: column;
    padding-left: var(--space-3);
    position: relative;
    z-index: 2;
  }

  .lab-grid-meta {
    font-family: var(--font-mono);
    font-size: 0.7rem;
    color: rgba(255,255,255,0.6);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    display: flex;
    align-items: center;
    gap: var(--space-3);
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
  }

  .status-badge {
    background: rgba(255,255,255,0.2);
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.6rem;
  }

  .lab-grid-title {
    font-family: var(--font-display);
    font-size: var(--text-xl);
    font-weight: 500;
    color: white;
    margin-top: auto;
    margin-bottom: var(--space-3);
    line-height: 1.3;
    text-shadow: 0 2px 4px rgba(0,0,0,0.4);
  }

  .lab-grid-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
  }

  .lab-grid-tag {
    font-family: var(--font-mono);
    font-size: 0.65rem;
    color: rgba(255,255,255,0.7);
    background: rgba(255,255,255,0.1);
    padding: 2px 8px;
    border-radius: 4px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
  }

  .lab-grid-info {
    padding: var(--space-5);
  }

  .lab-grid-description {
    font-size: var(--text-sm);
    color: var(--ink-soft);
    line-height: 1.6;
    margin-bottom: var(--space-4);
  }

  .lab-grid-cta {
    font-family: var(--font-mono);
    font-size: 0.8rem;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
  }

  .lab-grid-cta svg {
    width: 16px;
    height: 16px;
    stroke: currentColor;
    stroke-width: 2;
    fill: none;
    transition: transform 0.2s ease;
  }

  .lab-grid-card:hover .lab-grid-cta svg {
    transform: translateX(4px);
  }

  @media (max-width: 768px) {
    .lab-page {
      padding: var(--space-9) var(--space-5);
    }

    .lab-grid {
      grid-template-columns: 1fr;
    }
  }
</style>